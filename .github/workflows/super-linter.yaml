name: Mega Linter Analysis

on:
  push:
    branches:
      - master  # Trigger workflow on push to the master branch

jobs:
  mega-linter:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Create lint-reports directory
      run: mkdir -p /tmp/lint-reports/sarif

    - name: Run Mega-Linter
      uses: oxsecurity/megalinter@v7
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        DEFAULT_BRANCH: master
        OUTPUT_FORMAT: sarif
        OUTPUT_FOLDER: /tmp/lint-reports/sarif
        SARIF_REPORTER: true  # Enable SARIF report generation
      continue-on-error: true
    - name: Verify SARIF report exists
      run: ls -l /tmp/lint-reports/sarif/megalinter-report.sarif

    - name: Upload SARIF files
      if: success() || failure()
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: /tmp/lint-reports/sarif/*.sarif
